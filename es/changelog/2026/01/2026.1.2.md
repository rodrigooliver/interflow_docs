# v2026.1.2

Fecha de lanzamiento: **21 de Enero de 2026**

---

## âœ¨ Nuevas Funcionalidades

### Control de Acceso Granular al CRM

Implementado sistema completo de permisos que permite controlar exactamente lo que cada agente puede visualizar en el mÃ³dulo CRM. Ahora es posible garantizar que cada usuario tenga acceso solo a los datos de los clientes que atiende directamente.

#### Â¿Para quÃ© sirve?

- âœ… **Privacidad y Seguridad**: Datos confidenciales de clientes protegidos y accesibles solo a los responsables directos
- âœ… **Cumplimiento LGPD**: Cumple con requisitos de protecciÃ³n de datos y minimizaciÃ³n de acceso a informaciÃ³n personal
- âœ… **Experiencia Enfocada**: Agente visualiza solo lo que necesita para su trabajo, con interfaz mÃ¡s limpia y objetiva
- âœ… **Control Administrativo**: Gestores deciden el nivel de acceso de cada usuario segÃºn necesidad del negocio

#### Â¿CÃ³mo funciona?

**Para Agentes Limitados (agent_limited)**:
1. MenÃº CRM: Visualiza solo la opciÃ³n "Clientes que atiendo"
2. Pantalla del Embudo: Ve solo los clientes asignados a Ã©l
3. Filtro AutomÃ¡tico: El sistema filtra automÃ¡ticamente solo sus clientes
4. Sin Toggle: BotÃ³n para alternar entre "todos" y "mis clientes" queda oculto

**Para Otros Agentes (agent)**:
1. MenÃº CRM: Pueden elegir entre "Clientes que atiendo" y "Todos los clientes"
2. Pantalla del Embudo: Pueden usar un toggle para alternar la visualizaciÃ³n
3. Permisos: Pueden leer y editar (pero no crear o eliminar)

**Para Administradores y Gestores**:
- Acceso total sin restricciones
- Visualizan todos los clientes
- Pueden gestionar pipelines y exportar datos

#### Â¿CÃ³mo configurar?

1. Acceda al menÃº **Usuarios** (Ã¡rea administrativa)
2. Seleccione el usuario que desea configurar
3. En el campo **Permiso/Rol**, elija **"Agente Limitado"** (agent_limited)
4. Guarde los cambios

**Â¡Listo!** El agente solo verÃ¡ sus propios clientes en el CRM.

#### Tipos de Permisos Disponibles

- **Owner/Admin**: Acceso total sin restricciones
- **Manager**: Visualiza todos pero con algunas restricciones administrativas
- **Agent (Agente Normal)**: Accede a sus clientes + puede ver todos si es necesario
- **Agent Limited (Agente Limitado)**: â­ **Recomendado** - Ve SOLO sus clientes

---

### Consulta de Clientes por Permiso de Usuario

El listado de clientes ahora respeta los permisos del usuario conectado en todos los mÃ³dulos del sistema (Clientes, CRM y Atenciones).

#### Â¿Para quÃ© sirve?

- âœ… **Seguridad mejorada**: Agentes con permiso `agent_limited` visualizan solo clientes relacionados con sus propias atenciones
- âœ… **Privacidad de datos**: Impide que agentes accedan a informaciÃ³n de clientes no asignados a ellos
- âœ… **Cumplimiento normativo**: Cumple con requisitos de protecciÃ³n de datos y privacidad
- âœ… **Control granular**: Administradores continÃºan con acceso completo a la base de clientes

#### Â¿CÃ³mo funciona?

1. **Para Administradores y Supervisores**: Visualizan todos los clientes del equipo normalmente
2. **Para Agentes con `agent_limited`**: 
   - Visualizan solo clientes de las atenciones asignadas a ellos
   - El listado se filtra automÃ¡ticamente segÃºn el campo `last_assigned_to`
   - No necesita configuraciÃ³n adicional

---

## ğŸ”’ Seguridad

### Control de Acceso Multinivel a Datos de Clientes

- **Interfaz (UI)**: Oculta opciones y controles no permitidos al perfil del usuario
- **Backend**: Funciones especÃ­ficas en la base de datos (`get_customers_by_stage_v2`, `get_stage_customer_counts_v2`) filtran automÃ¡ticamente los datos
- **Permisos**: Sistema de roles garantiza que solo se acceda a datos autorizados
- **AuditorÃ­a**: Historial de accesos mantenido para trazabilidad

### Mejoras TÃ©cnicas

- Creadas versiones v2 de las funciones de consulta del CRM con filtro por `last_assigned_to`
- Implementado hook `usePermissions` para control de acceso basado en roles
- AÃ±adidas constantes de permisos (`PERMISSION_TEMPLATES`) para todos los perfiles
- IntegraciÃ³n completa entre Sidebar, CRMFunnel y hooks de datos

---

## ğŸ¯ Beneficios

- âœ… **Mayor privacidad**: Datos de clientes protegidos por mÃºltiples capas de seguridad
- âœ… **Cumplimiento LGPD**: Cumple con principios de minimizaciÃ³n de datos y acceso restringido
- âœ… **GestiÃ³n facilitada**: Agentes se enfocan solo en sus clientes
- âœ… **Seguridad mejorada**: Reduce drÃ¡sticamente riesgos de fuga de informaciÃ³n
- âœ… **Experiencia optimizada**: Interfaz mÃ¡s limpia y objetiva para cada perfil de usuario
- âœ… **Flexibilidad**: Administradores pueden ajustar permisos segÃºn necesidad
