# v2026.1.2

Data de lan√ßamento: **21 de Janeiro de 2026**

---

## ‚ú® Novas Funcionalidades

### Controle de Acesso Granular ao CRM

Implementado sistema completo de permiss√µes que permite controlar exatamente o que cada atendente pode visualizar no m√≥dulo de CRM. Agora √© poss√≠vel garantir que cada usu√°rio tenha acesso apenas aos dados dos clientes que atende diretamente.

#### Para que serve?

- ‚úÖ **Privacidade e Seguran√ßa**: Dados confidenciais dos clientes ficam protegidos e acess√≠veis apenas aos respons√°veis diretos
- ‚úÖ **Conformidade LGPD**: Atende requisitos de prote√ß√£o de dados e minimiza√ß√£o de acesso a informa√ß√µes pessoais
- ‚úÖ **Experi√™ncia Focada**: Atendente visualiza apenas o que precisa para seu trabalho, com interface mais limpa e objetiva
- ‚úÖ **Controle Administrativo**: Gestores decidem o n√≠vel de acesso de cada usu√°rio conforme necessidade do neg√≥cio

#### Como funciona?

**Para Atendentes Limitados (agent_limited)**:
1. No Menu CRM: Visualiza apenas a op√ß√£o "Clientes que atendo"
2. Na Tela do Funil: V√™ somente os clientes atribu√≠dos a ele
3. Filtro Autom√°tico: O sistema automaticamente filtra apenas seus clientes
4. Sem Toggle: Bot√£o de alternar entre "todos" e "meus clientes" fica oculto

**Para Outros Atendentes (agent)**:
1. No Menu CRM: Podem escolher entre "Clientes que atendo" e "Todos os clientes"
2. Na Tela do Funil: Podem usar um toggle para alternar a visualiza√ß√£o
3. Permiss√µes: Podem ler e editar (mas n√£o criar ou excluir)

**Para Administradores e Gestores**:
- Acesso total sem restri√ß√µes
- Visualizam todos os clientes
- Podem gerenciar pipelines e exportar dados

#### Como configurar?

1. Acesse o menu **Usu√°rios** (√°rea administrativa)
2. Selecione o usu√°rio que deseja configurar
3. No campo **Permiss√£o/Fun√ß√£o**, escolha **"Atendente Limitado"** (agent_limited)
4. Salve as altera√ß√µes

**Pronto!** O atendente s√≥ ver√° seus pr√≥prios clientes no CRM.

#### Tipos de Permiss√µes Dispon√≠veis

- **Owner/Admin**: Acesso total sem restri√ß√µes
- **Manager**: Visualiza todos mas com algumas restri√ß√µes administrativas
- **Agent (Atendente Normal)**: Acessa seus clientes + pode ver todos se necess√°rio
- **Agent Limited (Atendente Limitado)**: ‚≠ê **Recomendado** - V√™ APENAS seus clientes

---

### Consulta de Clientes por Permiss√£o de Usu√°rio

Agora a listagem de clientes respeita as permiss√µes do usu√°rio logado em todos os m√≥dulos do sistema (Clientes, CRM e Atendimentos).

#### Para que serve?

- ‚úÖ **Seguran√ßa aprimorada**: Agentes com permiss√£o `agent_limited` visualizam apenas clientes relacionados aos seus pr√≥prios atendimentos
- ‚úÖ **Privacidade de dados**: Impede que agentes acessem informa√ß√µes de clientes n√£o atribu√≠dos a eles
- ‚úÖ **Conformidade**: Atende requisitos de prote√ß√£o de dados e privacidade
- ‚úÖ **Controle granular**: Administradores continuam com acesso completo √† base de clientes

#### Como funciona?

1. **Para Administradores e Supervisores**: Visualizam todos os clientes da equipe normalmente
2. **Para Agentes com `agent_limited`**: 
   - Visualizam apenas clientes dos atendimentos que foram atribu√≠dos a eles
   - A listagem √© automaticamente filtrada com base no campo `last_assigned_to`
   - N√£o h√° necessidade de configura√ß√£o adicional

---

## üîí Seguran√ßa

### Controle de Acesso Multin√≠vel a Dados de Clientes

- **Interface (UI)**: Oculta op√ß√µes e controles n√£o permitidos ao perfil do usu√°rio
- **Backend**: Fun√ß√µes espec√≠ficas no banco de dados (`get_customers_by_stage_v2`, `get_stage_customer_counts_v2`) filtram automaticamente os dados
- **Permiss√µes**: Sistema de roles garante que apenas dados autorizados sejam acessados
- **Auditoria**: Hist√≥rico de acessos mantido para rastreabilidade

### Melhorias T√©cnicas

- Criadas vers√µes v2 das fun√ß√µes de consulta do CRM com filtro por `last_assigned_to`
- Implementado hook `usePermissions` para controle de acesso baseado em roles
- Adicionadas constantes de permiss√µes (`PERMISSION_TEMPLATES`) para todos os perfis
- Integra√ß√£o completa entre Sidebar, CRMFunnel e hooks de dados

---

## üéØ Benef√≠cios

- ‚úÖ **Maior privacidade**: Dados de clientes protegidos por m√∫ltiplas camadas de seguran√ßa
- ‚úÖ **Conformidade LGPD**: Atende princ√≠pios de minimiza√ß√£o de dados e acesso restrito
- ‚úÖ **Gest√£o facilitada**: Atendentes focam apenas em seus clientes
- ‚úÖ **Seguran√ßa aprimorada**: Reduz drasticamente riscos de vazamento de informa√ß√µes
- ‚úÖ **Experi√™ncia otimizada**: Interface mais limpa e objetiva para cada perfil de usu√°rio
- ‚úÖ **Flexibilidade**: Administradores podem ajustar permiss√µes conforme necessidade
